<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8" />
    <title>An introduction to Doctrine 2 persistence with Zend Framework 2</title>
    <meta
        name="description"
        content="Using Doctrine 2 ORM, ODM and other persistence layers in a Zend Framework 2 application"
    />
    <meta name="author" content="Marco Pivetta" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="stylesheet" href="reveal.js/css/reveal.min.css" />
    <link rel="stylesheet" href="reveal.js/css/theme/default.css" id="theme" />
    <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css" />
    <script>
        document.write(
            '<link rel="stylesheet" href="reveal.js/css/print/'
            + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' )
            + '.css" type="text/css" media="print">'
        );
    </script>
    <!--[if lt IE 9]><script src="reveal.js/lib/js/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
<div class="reveal">
<div class="slides">

<section style="visibility:hidden;"></section>
<section>
    <h2>
        <img src="assets/img/ocramius.gif" alt="Marco Pivetta" style="height: 70px; margin: 0;"/>
        <a href="http://ocramius.github.com/" target="_blank">Marco Pivetta</a>
    </h2>
</section>
<section>
    <h2>
        <img src="assets/img/ocramius.gif" alt="Marco Pivetta" style="height: 70px; margin: 0;"/>
        <a href="http://ocramius.github.com/" target="_blank">Ocramius</a>
    </h2>
</section>
<section>
    <h2>
        <img
            src="assets/img/doctrine.svg"
            alt="Doctrine Project" border="0"
            height="100px"
            style="margin: -13px;"
        />
        <span class="doctrine-color">octrine</span> team
    </h2>
</section>
<section>
    <h2>
        <img
            src="assets/img/zf-logo.svg"
            alt="Zend Framework 2"
            width="150px"
            style="margin: -8px;"
        />
        contributor
    </h2>
</section>
<section>
    <h2>
        <img
            src="assets/img/gh.svg"
            alt="Ocramius on Github"
            height="70px"
            style="margin: 0;"
        />
        <img
            src="assets/img/twitter.svg"
            alt="Ocramius on Twitter"
            height="70px"
            style="margin: 0;"
        />
        <a href="http://twitter.com/Ocramius" target="_blank">Ocramius</a>
    </h2>
</section>

<section>
    <section>
        <h2>Current projects</h2>
        <p>
            <a target="_blank" href="https://github.com/Ocramius/ProxyManager">ProxyManager</a>,
            <a target="_blank" href="https://github.com/bjyoungblood/BjyAuthorize">BjyAuthorize</a>,
            <a target="_blank" href="https://github.com/RWOverdijk/AssetManager">AssetManager</a>,
            <a target="_blank" href="https://github.com/BinaryKitten/ZeffMu">ZeffMu</a>,
            <a target="_blank" href="https://github.com/zf-fr/ZfrRest">ZfrRest</a>,
            <a target="_blank" href="https://github.com/Ocramius/OcraDiCompiler">OcraDiCompiler</a>,
            <a target="_blank" href="https://github.com/Ocramius/OcraServiceManager">OcraServiceManager</a>,
            <a target="_blank" href="https://github.com/Ocramius/OcraCachedViewResolver">OcraCachedViewResolver</a>,
            <a target="_blank" href="https://github.com/doctrine/DoctrineModule">DoctrineModule</a>,
            <a target="_blank" href="https://github.com/doctrine/DoctrineORMModule">DoctrineORMModule</a>,
            <a target="_blank" href="https://github.com/doctrine/DoctrineMongoODMModule">DoctrineMongoODMModule</a>,
            <a target="_blank" href="https://github.com/Ocramius/VersionEyeModule">VersionEyeModule</a>
        </p>
    </section>
</section>
<section>
    <h1>WHY?</h1>
</section>
<section>
    <img src="assets/img/for-the-glory-of-satan.jpg" alt="For the glory of satan, of course!"/>
</section>

<section>
    <h1>
        <span class="doctrine-color">Doctrine 2</span>
        &amp;
        <span class="zf-color">ZF2</span>
    </h1>
    <h1>
        <img
                src="assets/img/doctrine.svg"
                alt="Doctrine Project" border="0"
                height="200px"
                style="margin-bottom: -50px; "
                />
        +
        <img
            src="assets/img/zf-logo.svg"
            alt="Zend Framework 2"
            border="0"
            height="200px"
            style="margin-bottom: -50px;"
        />
    </h1>
</section>

<section>
    <h2>What is <span class="doctrine-color">Doctrine ORM</span>?</h2>
    <p class="fragment">
        <span class="doctrine-color">Doctrine ORM</span> is an Object Relational Mapper
    </p>
    <p class="fragment">
        It is inspired by Hibernate and the <abbr title="Java Persistece API">JPA</abbr> (JSR-317)
    </p>
    <p class="fragment">
        It is based on a
        <abbr title="Database Abstraction Layer" class="doctrine-color">DBAL</abbr>
        (DataBase Abstraction Layer)
    </p>
    <p class="fragment">
        Allows developers to save and load <abbr title="Plain Old PHP Object">POPO</abbr> with SQL
    </p>

    <aside class="notes">
        Also consider that Doctrine ORM abstract the underlying SQL dialect of the DB platform you are
        using, so it's possible for you to switch DB vendor from a day to another
    </aside>
</section>

<section>
    <p>
        An <span class="doctrine-color">ORM</span> gives you the impression that you are working
        with a "virtual" graph composed by objects...
    </p>
    <p class="fragment">... backed by any persistence layer!</p>
</section>

<section>
    <p>
        Simpler:
    </p>
    <h2 class="fragment doctrine-color">Forget the database!</h2>

    <aside class="notes">
        The job of an ORM is all about abstracting the underlying data structure into something that
        gives the developer access to what looks like an in-memory representation of the database.
    </aside>
</section>

<section>
    <p>Doctrine works with simple objects (<abbr title="Plain Old PHP Objects" class="doctrine-color">POPO</abbr>)</p>
    <p class="fragment">
        Objects with an identifier are defined as <span class="doctrine-color">Entities</span>
    </p>
</section>

<!--
<section>
    <h2>Write your first <span class="doctrine-color">entity</span></h2>
</section>
-->

<section>
    <pre><code contenteditable>namespace Application\Entity;
use Doctrine\ORM\Mapping as ORM;

/** @ORM\Entity */
class User {
    /**
     * @ORM\Id
     * @ORM\GeneratedValue(strategy="AUTO")
     * @ORM\Column(type="integer")
     */
    protected $id;

    /** @ORM\Column(type="string") */
    protected $name;

    // getters/setters
}</code></pre>
</section>

<section>
    <h2>Everything OK so far?</h2>
    <pre class="fragment"><code contenteditable>php public/index.php orm:validate-schema</code></pre>
    <p class="fragment">
        <img src="assets/img/validate-mappings.png" alt="Validate schema mappings" />
    </p>
</section>

<section>
    <h2><span class="doctrine-color">Generate</span> the database</h2>
    <pre class="fragment"><code contenteditable>php public/index.php orm:schema-tool:create</code></pre>
    <p class="fragment">
        <img src="assets/img/database-generated-successfully.png" alt="generating the database"/>
    </p>
</section>

<!--
<section>
    <h2>Let's use it!</h2>
</section>
-->

<section>
    <pre><code contenteditable>$objectManager = \Doctrine\ORM\EntityManager::create(/* yadda */);</code></pre>
</section>

<section>
    <pre><code contenteditable>$objectManager = \Doctrine\ORM\EntityManager::create(/* yadda */);

$user = new \Application\Entity\User();
$user->setName('Zaphod Beeblebrox');

$objectManager->persist($user);
$objectManager->flush();

var_dump($user->getId());</code></pre>
</section>

<section>
    <h1>ಠ_ಠ</h1>
</section>

<section>
    <h3><span class="doctrine-color">Persisting</span> an object</h3>
    <pre><code contenteditable>$user = new \Application\Entity\User();
$user->setName('Arthur Dent');

$objectManager->persist($user); // $user is now "managed"
$objectManager->flush();        // commit changes to db

var_dump($user->getId()); // 1</code></pre>
</section>

<section>
    <h3><span class="doctrine-color">Loading</span> an object</h3>
    <pre><code contenteditable>$ford = $objectManager
    ->getRepository('Application\Entity\User')
    ->findOneBy(array('name' => 'Ford Prefect'));</code></pre>
</section>

<section>
    <h3><span class="doctrine-color">Updating</span> an object</h3>
    <pre><code contenteditable>$marvin = $objectManager
    ->getRepository('Application\Entity\User')
    ->findOneBy(array('name' => 'Marvin'));

$marvin->setName('Marvin the Paranoid Android');

$objectManager->flush();</code></pre>
</section>

<section>
    <h3><span class="doctrine-color">Deleting</span> an object</h3>
    <pre><code contenteditable>$president = $objectManager
    ->getRepository('Application\Entity\User')
    ->findOneBy(array('name' => 'Zaphod Beeblebrox'));

$objectManager->remove($president);
$objectManager->flush();</code></pre>
</section>

<section>
    <h2>Associations</h2>
</section>

<section>
    <pre><code contenteditable>namespace Application\Entity;
use Doctrine\ORM\Mapping as ORM;

/** @ORM\Entity */
class Address {
    /**
     * @ORM\Id
     * @ORM\GeneratedValue(strategy="AUTO")
     * @ORM\Column(type="integer")
     */
    protected $id;

    /** @ORM\Column(type="string") */
    protected $country;

    // getters/setters
}</code></pre>
</section>

<section>
    <pre><code contenteditable>class User {
    // ...

    /** @ORM\ManyToOne(targetEntity="Address") */
    protected $address;

    // ...
}</code></pre>
</section>
<section>
    <pre><code contenteditable>$user = new User();
$user->setName('Arthur Dent');
$objectManager->persist($user);

$address = new Address();
$address->setCountry('UK');
$objectManager->persist($address);

$user->setAddress($address);
$objectManager->flush();</code></pre>
</section>

<section>
    <pre><code contenteditable>$user = $objectManager
    ->getRepository('Application\Entity\User')
    ->findOneBy(array('name' => 'Arthur Dent'));

echo $user->getAddress()->getCountry(); // UK</code></pre>
</section>

<section>
    <pre><code contenteditable>class User {
    // ...

    /** @ORM\ManyToMany(targetEntity="User") */
    protected $friends;

    public function __construct() {
        $this->friends = new \Doctrine\Common\Collections\ArrayCollection();
    }

    // ...
}</code></pre>
</section>

<section>
    <pre><code contenteditable>$arthur = new User();
$arthur->setName('Arthur Dent');
$objectManager->persist($arthur);

$trillian = new User();
$trillian->setName('Tricia Marie McMillan');
$objectManager->persist($trillian);

$zaphod = new User();
$zaphod->setName('Zaphod Beeblebrox');
$objectManager->persist($zaphod);

$arthur->getFriends()->add($trillian);
$trillian->getFriends()->add($zaphod);

$objectManager->flush();</code></pre>
</section>

<section>
<pre><code contenteditable>$arthur = $objectManager
    ->getRepository('Application\Entity\User')
    ->findOneBy(array('name' => 'Arthur Dent'));

foreach ($arthur->getFriends() as $friend) {
    echo $friend->getName() . "\n";
}</code></pre>

    <p class="fragment">Note: Trillian doesn't see Arthur as a friend</p>
    <p class="fragment">Note2: Zaphod doesn't see Trillian as a friend</p>
</section>

<!-- modules description - move later in the text! -->

<!--
<section>
    <h2>
        The <span class="zf-color">Modules</span>!
    </h2>
    <p class="fragment">
        <span class="zf-color">DoctrineModule</span>
        <br/>
        basic common functionality
    </p>
    <p class="fragment">
        <span class="zf-color">DoctrineORMModule</span>
        <br/>
        ORM/SQL Connection
    </p>
    <p class="fragment">
        <span class="zf-color">DoctrineMongoODMModule</span>
        <br/>
        ODM/MongoDB Connection
    </p>

    <aside class="notes">
        DoctrineModule is a set of functionality common to all ZF2-Doctrine integration layers
    </aside>
</section>


<section data-state="soothe">
    <p>
        <img src="http://yuml.me/diagram/scruffy;dir:TB;/class/[doctrine/common{bg:orange}]<-.- [doctrine/doctrine-module{bg:green}],[doctrine/orm{bg:orange}]<-.- [doctrine/doctrine-orm-module{bg:green}],[doctrine/mongodb-odm{bg:orange}]<-.- [doctrine/doctrine-mongo-odm-module{bg:green}],[doctrine/doctrine-module{bg:green}]<-.- [doctrine/doctrine-orm-module{bg:green}],[doctrine/doctrine-module{bg:green}]<-.- [doctrine/doctrine-mongo-odm-module{bg:green}],[doctrine/common{bg:orange}]<-.- [doctrine/mongodb-odm{bg:orange}],[doctrine/common{bg:orange}]<-.- [doctrine/orm{bg:orange}]">
    </p>
</section>

-->

</div>
</div>

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.min.js"></script>
<script>

    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme || 'sky', // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
            { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
            { src: 'reveal.js/plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
            { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
            { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
            // { src: 'reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
    });

</script>
<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-15310667-1']);
    _gaq.push(['_setDomainName', 'marco-pivetta.com']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>

</body>
</html>
